<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Characterization Package Specification • Characterization</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Characterization Package Specification">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Characterization</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/InstallationGuide.html"><span class="fa fa-download fa-lg"></span> Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-info-circle fa-lg"></span> Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/InstallationGuide.html">Characterization Installation Guide</a></li>
    <li><a class="dropdown-item" href="../articles/Specification.html">Characterization Package Specification</a></li>
    <li><a class="dropdown-item" href="../articles/UsingPackage.html">Using Characterization Package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o fa-lg"></span> Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/Characterization"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Characterization Package Specification</h1>
                        <h4 data-toc-skip class="author">Jenna Reps</h4>
            
            <h4 data-toc-skip class="date">2025-02-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/Characterization/blob/develop/vignettes/Specification.Rmd" class="external-link"><code>vignettes/Specification.Rmd</code></a></small>
      <div class="d-none name"><code>Specification.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="time-to-event">Time-to-event<a class="anchor" aria-label="anchor" href="#time-to-event"></a>
</h2>
<div class="section level3">
<h3 id="inputs">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h3>
<p>A vector of targetIds and a vector of outcomeIds</p>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>Summary data.frame with the counts of how often an outcome occurred
within a time-period relative to the first target index date for each
combination of target and outcome. The counts are stratified by whether
the outcome was first event or subsequent and the timing category for
when the outcome occurred (before first target exposure, during first
target exposure, during a subsequent target exposure, between target
exposures and after last target exposure).</p>
</div>
<div class="section level3">
<h3 id="worked-example">Worked Example<a class="anchor" aria-label="anchor" href="#worked-example"></a>
</h3>
<div class="section level4">
<h4 id="example-inputs">Example Inputs<a class="anchor" aria-label="anchor" href="#example-inputs"></a>
</h4>
<p>Here we consider the inputs are:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targetIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">outcomeIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> </span></code></pre></div>
<p>Consider we have five patients; the target cohort (dates each of the
five patients are exposed to a drug) is in Table 1 and the outcome
cohort (dates each of the five patients have the outcome) is in Table 2.
This is also illustrated in Figures 1 and 2.</p>
</div>
<div class="section level4">
<h4 id="example-data-image">Example Data Image<a class="anchor" aria-label="anchor" href="#example-data-image"></a>
</h4>
<div class="float">
<img src="images%2Ftte_example_data.png" alt="Figure 1 - Example data for five patients with dates."><div class="figcaption">Figure 1 - Example data for five patients with
dates.</div>
</div>
<div class="float">
<img src="images%2Ftte_example_data_with_times.png" alt="Figure 2 - Example data for five patients with timing."><div class="figcaption">Figure 2 - Example data for five patients with
timing.</div>
</div>
</div>
<div class="section level4">
<h4 id="example-data-table">Example Data Table<a class="anchor" aria-label="anchor" href="#example-data-table"></a>
</h4>
<table class="table">
<caption>Example time-to-event data with dates.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">cohortDefinitionId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-01-20</td>
<td align="left">2001-01-25</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-10-20</td>
<td align="left">2001-12-05</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2005-09-10</td>
<td align="left">2005-09-15</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-02-01</td>
<td align="left">2003-02-30</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-08-04</td>
<td align="left">2003-08-24</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2005-02-01</td>
<td align="left">2005-10-08</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2007-04-03</td>
<td align="left">2007-05-03</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Example time-to-event data with timing.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">cohortDefinitionId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">1999-10-03</td>
<td align="left">1999-10-08</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2001-10-30</td>
<td align="left">2001-11-07</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">2004-05-16</td>
<td align="left">2004-05-18</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2002-06-03</td>
<td align="left">2002-06-14</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2003-02-20</td>
<td align="left">2003-03-01</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2006-07-21</td>
<td align="left">2006-08-03</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2008-01-01</td>
<td align="left">2008-01-09</td>
</tr>
</tbody>
</table>
<p>For all rows in the outcome table, we calculate the time between the
patients first exposure in the target cohort and the outcome date
(time-to-event), we classify the ‘type’ as the timing of when the
outcome occurs with ‘before first exposure’ meaning the outcome occurs
before the patient is observed in the target cohort, ‘during first’
means the outcome occurs during the first target cohort exposure,
‘between eras’ means the outcome occurs between target exposures,
‘during subsequent’ means the outcome occurs during a non-first target
exposure and ‘after last exposure’ means the outcome occurs after the
last exposure in the target cohort’s end date for the patient. The
outcome type is classified whether the outcome is the ‘first occurrence’
or a ‘subsequent occurrence’. Let’s consider patient 1, he has the
outcome twice. The first outcome occurs 475 days before his first target
exposure and his second outcome occurs 283 days after his first target
exposure. The second outcome for patient 1 occurs during a subsequent
target exposure era (not the first). Patient 2 does not have the outcome
so does not contribute to the time-to-event. Patient 3 has her first
(and only) outcome during the first exposure to the drug and 44 days
after she started the drug for the first time. Patient 4 has the outcome
twice, 92 days after the first exposure to the drug and 354 days after.
The first time she has the outcome is during the first exposure to the
drug and the subsequent time she has the outcome is during her second
exposure (subsequent exposure). Patient 5 has the outcome twice, 535
days after he is first exposure to the drug and 1064 days after. The
first time he has the outcome occurs between drug exposure eras and the
subsequent outcome occurs after the last exposure era. This is
summarized in Table 3.</p>
<table class="table">
<caption>Table 3: Time-to-event intermediate summary.</caption>
<colgroup>
<col width="11%">
<col width="13%">
<col width="20%">
<col width="13%">
<col width="25%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="left">outcomeDate</th>
<th align="left">firstExposureDate</th>
<th align="right">timeToEvent</th>
<th align="left">type</th>
<th align="left">outcomeType</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">1999-10-03</td>
<td align="left">2001-01-20</td>
<td align="right">-475</td>
<td align="left">Before first exposure</td>
<td align="left">First</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2001-10-30</td>
<td align="left">2001-01-20</td>
<td align="right">283</td>
<td align="left">During subsequent</td>
<td align="left">Subsequent</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">2004-05-16</td>
<td align="left">2004-04-02</td>
<td align="right">44</td>
<td align="left">During first</td>
<td align="left">First</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">2002-06-03</td>
<td align="left">2002-03-03</td>
<td align="right">92</td>
<td align="left">During first</td>
<td align="left">First</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">2003-02-20</td>
<td align="left">2002-03-03</td>
<td align="right">354</td>
<td align="left">During subsequent</td>
<td align="left">Subsequent</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">2006-07-21</td>
<td align="left">2005-02-01</td>
<td align="right">535</td>
<td align="left">Between eras</td>
<td align="left">First</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">2008-01-01</td>
<td align="left">2005-02-01</td>
<td align="right">1064</td>
<td align="left">After last exposure</td>
<td align="left">Subsequent</td>
</tr>
</tbody>
</table>
<p>The time-to-event output aggregates the summary table into three
different perspectives:</p>
<ul>
<li><p>1-day aggregate – this calculates the total number of patients
that have the outcome at each time-to-event day grouped by type and
outcome type. Only looks at outcomes between -100 days and 100 days for
the time-to-event.</p></li>
<li><p>30-day aggregate – this calculates the total number of patients
that have the outcome at each 30-day sliding window for time-to-event
(e.g., 0-29, 30-59, 60-89, etc.) grouped by type and outcome type. Only
looks at outcomes between -1095 days and 1095 days for the
time-to-event.</p></li>
<li><p>365-day aggregate – this calculates the total number of patients
that have the outcome at each 365-day sliding window for time-to-event
(e.g., 0-365, 366-730, 731-1095, etc.) grouped by type and outcome type.
Only looks at outcomes between -1095 days and 1095 days for the
time-to-event.</p></li>
</ul>
<p>The summary results that would be output by time-to-event are
displayed in Table 4.</p>
<table class="table">
<caption>Table 4: Time-to-event output.</caption>
<colgroup>
<col width="13%">
<col width="32%">
<col width="17%">
<col width="14%">
<col width="11%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">timeType</th>
<th align="left">Type</th>
<th align="left">outcomeType</th>
<th align="right">timeStart</th>
<th align="right">timeEnd</th>
<th align="right">count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1-day</td>
<td align="left">During first</td>
<td align="left">First</td>
<td align="right">44</td>
<td align="right">44</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">1-day</td>
<td align="left">During first</td>
<td align="left">First</td>
<td align="right">92</td>
<td align="right">92</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">30-day</td>
<td align="left">Before first exposure</td>
<td align="left">First</td>
<td align="right">-481</td>
<td align="right">-450</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">30-day</td>
<td align="left">During first</td>
<td align="left">First</td>
<td align="right">31</td>
<td align="right">60</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">30-day</td>
<td align="left">During first</td>
<td align="left">First</td>
<td align="right">91</td>
<td align="right">120</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">30-day</td>
<td align="left">During subsequent</td>
<td align="left">Subsequent</td>
<td align="right">271</td>
<td align="right">300</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">30-day</td>
<td align="left">During subsequent</td>
<td align="left">Subsequent</td>
<td align="right">331</td>
<td align="right">360</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">30-day</td>
<td align="left">Between eras</td>
<td align="left">First</td>
<td align="right">511</td>
<td align="right">540</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">30-day</td>
<td align="left">After last exposure</td>
<td align="left">Subsequent</td>
<td align="right">1051</td>
<td align="right">1080</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">365-day</td>
<td align="left">Before first exposure</td>
<td align="left">First</td>
<td align="right">-731</td>
<td align="right">-365</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">365-day</td>
<td align="left">During first</td>
<td align="left">First</td>
<td align="right">1</td>
<td align="right">365</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">365-day</td>
<td align="left">During subsequent</td>
<td align="left">Subsequent</td>
<td align="right">1</td>
<td align="right">365</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">365-day</td>
<td align="left">Between eras</td>
<td align="left">First</td>
<td align="right">366</td>
<td align="right">730</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">365-day</td>
<td align="left">After last exposure</td>
<td align="left">Subsequent</td>
<td align="right">731</td>
<td align="right">1095</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level2">
<h2 id="dechallenge-rechallenge">Dechallenge-rechallenge<a class="anchor" aria-label="anchor" href="#dechallenge-rechallenge"></a>
</h2>
<div class="section level3">
<h3 id="inputs-1">Inputs<a class="anchor" aria-label="anchor" href="#inputs-1"></a>
</h3>
<p>A vector of targetIds, a vector of outcomeIds, an integer
dechallengeStopInterval and an integer dechallengeEvaluationWindow.</p>
</div>
<div class="section level3">
<h3 id="output-1">Output<a class="anchor" aria-label="anchor" href="#output-1"></a>
</h3>
<p>A summary data.frame with the number of dechallenge and rechallenge
attempts per target and outcome combination plus the number of
dechallange/rechallenge attempts that were successes and failures.</p>
</div>
<div class="section level3">
<h3 id="worked-example-1">Worked Example<a class="anchor" aria-label="anchor" href="#worked-example-1"></a>
</h3>
<p>The dechallenge-rechallenge analysis finds out how often a patient
stops the drug due to the occurrence of an outcome and whether the
outcome stops, then it looks at whether people re-exposed have the
outcome start again. In observational data we infer these situations by
finding cases where a patient has the outcome recorded during a drug
exposure and seems to stop the drug within &lt;dechallenge stop interval
days – default 30 days&gt; after the outcome occurs. For patients who
have a dechallenge, we then determine whether it is a success (the
outcome stops) or a failure (the outcome continues). This is determined
by seeing whether the outcome starts within &lt;decallenge evaluation
window days – default 30 days&gt; after the exposure ends (outcome
starting is a dechallenge failure otherwise it is a success). For
patients who had a dechallenge, we then look at whether they have
another exposure (after decallenge evaluation window days from the first
exposure end), which is a rechallenge and this is classed as a failure
(if the outcome does not start during the rechallenge exposure era) and
a success (if the outcome does occur during the rechallenge exposure
era).</p>
<div class="section level4">
<h4 id="example-inputs-1">Example Inputs<a class="anchor" aria-label="anchor" href="#example-inputs-1"></a>
</h4>
<p>Here we consider the inputs are:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targetIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">outcomeIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">dechallengeStopInterval</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">dechallengeEvaluationWindow</span> <span class="op">&lt;-</span> <span class="fl">31</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-data-plot">Example Data Plot<a class="anchor" aria-label="anchor" href="#example-data-plot"></a>
</h4>
<div class="float">
<img src="images%2Fdcrc_example_data.png" alt="Figure 3 - Example data for five patients with dates."><div class="figcaption">Figure 3 - Example data for five patients with
dates.</div>
</div>
</div>
<div class="section level4">
<h4 id="example-data-table-1">Example Data Table<a class="anchor" aria-label="anchor" href="#example-data-table-1"></a>
</h4>
<table class="table">
<caption>Example dechallenge-rechallenge data with dates.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">cohortDefinitionId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-01-20</td>
<td align="left">2001-01-25</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-10-20</td>
<td align="left">2001-12-05</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2005-09-10</td>
<td align="left">2005-09-15</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2006-03-04</td>
<td align="left">2006-03-21</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2006-05-03</td>
<td align="left">2006-05-05</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-02-01</td>
<td align="left">2003-02-30</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-08-04</td>
<td align="left">2003-08-24</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2005-02-01</td>
<td align="left">2005-10-08</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2007-04-03</td>
<td align="left">2007-05-03</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Example time-to-event data with timing.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">cohortDefinitionId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">1999-10-03</td>
<td align="left">1999-10-08</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2001-10-30</td>
<td align="left">2001-11-07</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">2004-05-16</td>
<td align="left">2004-05-18</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2002-06-03</td>
<td align="left">2002-06-14</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2003-02-20</td>
<td align="left">2003-03-01</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2006-07-21</td>
<td align="left">2006-08-03</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2008-01-01</td>
<td align="left">2008-01-09</td>
</tr>
</tbody>
</table>
<p>Let’s consider ten patients in Table 5 and Table 6 with 30 days for
the dechallenge stop interval and 31 days for the decallenge evaluation
window. First, find all cases where the outcome occurs during any
exposure era and then the exposure ends within 30 days after the outcome
start. These are the dechallenges. Then investigate whether a new
outcome starts within 31 days of the exposure era ending. These are the
failed dechallenges, otherwise the dechallenge is a success. Next, for
the dechallenges, find any drug exposures that occur more than 31 days
after the dechallenge exposure era end. These are rechallaneges. For
each rechallenge, determine whether the outcome starts within 31 days of
the rechallenge exposure era start. If an outcome occurs, the
rechallenge is a success, otherwise it is a failure.</p>
</div>
<div class="section level4">
<h4 id="intermediary-table">Intermediary Table<a class="anchor" aria-label="anchor" href="#intermediary-table"></a>
</h4>
<table style="width:100%;" class="table">
<caption>Dehcallenge-rechallenge summary table showing each dechallenge.
Only some patients with a dechallenge will have a rechallenge.</caption>
<colgroup>
<col width="9%">
<col width="11%">
<col width="11%">
<col width="12%">
<col width="13%">
<col width="12%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="left">outcomeDate</th>
<th align="left">exposureEnd</th>
<th align="left">outcomeAfter</th>
<th align="left">futureExposure</th>
<th align="left">futureOutcome</th>
<th align="left">dechallengeType</th>
<th align="left">rechallengeType</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2001-11-30</td>
<td align="left">2001-12-05</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">Success</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2006-03-10</td>
<td align="left">2006-03-21</td>
<td align="left">-</td>
<td align="left">2006-05-03</td>
<td align="left">-</td>
<td align="left">Seccess</td>
<td align="left">Success</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">2004-05-16</td>
<td align="left">2004-05-17</td>
<td align="left">2004-01-12</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">Fail</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">2002-06-03</td>
<td align="left">2002-06-12</td>
<td align="left">-</td>
<td align="left">2003-01-01</td>
<td align="left">2003-02-20</td>
<td align="left">Success</td>
<td align="left">Fail</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="intermediary-plots">Intermediary Plots<a class="anchor" aria-label="anchor" href="#intermediary-plots"></a>
</h4>
<div class="float">
<img src="images%2Fdcrc_dechal_summary.png" alt="Figure 4 - Example data for five patients with dechallenges highlighted and labelled."><div class="figcaption">Figure 4 - Example data for five patients with
dechallenges highlighted and labelled.</div>
</div>
<div class="float">
<img src="images%2Fdcrc_rechal_summary.png" alt="Figure 5 - Example data for five patients with rechallenges highlighted and labelled."><div class="figcaption">Figure 5 - Example data for five patients with
rechallenges highlighted and labelled.</div>
</div>
</div>
<div class="section level4">
<h4 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h4>
<p>We would then summarize the results by saying there were 4
dechallenges, 3 of which were a success and 1 of which was a fail. 2
patients had rechallenges with 1 being a fail and 1 being a success, see
Table 8 as the example output for one target and outcome.</p>
<table class="table">
<caption>Dehcallenge-rechallenge output.</caption>
<colgroup>
<col width="17%">
<col width="16%">
<col width="16%">
<col width="17%">
<col width="16%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="right">dechallengeAttempts</th>
<th align="right">dechallengeSuccess</th>
<th align="right">dechallengeFailure</th>
<th align="right">rechallengeAttempts</th>
<th align="right">rechallengeSuccess</th>
<th align="right">rechallangeFailure</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">4</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr></tbody>
</table>
<p><strong>Note:</strong> The way an outcome and exposure phenotype are
designed can make it impossible or unlikely to see a dechallenge fail.
For example, if an outcome is designed with a 365 day washout window,
then it means there cannot be another outcome occurring within 365 days
of another outcome. As a dechallange failure is the outcome occurring
within dechallenge evaluation window days after the exposure ends (and
the exposure must end within stop interval days of the outcome to be a
dechallenge), then using the defaults for these values means a
dechallenge failure requires an outcome to be possible within 60 days of
the dechallenge outcome, which is impossible with a 365 washout
window.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="aggregate-covariates">Aggregate Covariates<a class="anchor" aria-label="anchor" href="#aggregate-covariates"></a>
</h2>
<div class="section level3">
<h3 id="inputs-2">Inputs<a class="anchor" aria-label="anchor" href="#inputs-2"></a>
</h3>
<p>A vector of targetIds plus the minimum prior observation required for
the target cohorts and specifying which features to extract
(covariateSettings).</p>
</div>
<div class="section level3">
<h3 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h3>
<p>For each target cohort restricted to only the patients with minimum
prior observation at index and first occurrence the mean value for each
feature of interest is extracted into a data.frame.</p>
</div>
<div class="section level3">
<h3 id="worked-example-2">Worked Example<a class="anchor" aria-label="anchor" href="#worked-example-2"></a>
</h3>
<p>The aggregate covariates calculates the mean value of a feature
within a cohort of patients. In this analysis we restrict to first
occurrence in the cohort with a minimum prior observation in days
specified by the user (default 365 days). This restriction is
implemented as otherwise a patient could contribute multiple times to
the mean value and this makes interpretation difficult.</p>
<div class="section level4">
<h4 id="example-inputs-2">Example Inputs<a class="anchor" aria-label="anchor" href="#example-inputs-2"></a>
</h4>
<p>Here we consider the inputs are:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minPriorObservation</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">covariateSettings</span> <span class="op">&lt;-</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createCovariateSettings.html" class="external-link">createCovariateSettings</a></span><span class="op">(</span></span>
<span>  useDemographicsAge <span class="op">=</span> <span class="cn">T</span>, </span>
<span>  useDemographicsGender <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  useConditionOccurrenceAnyTimePrior <span class="op">=</span> <span class="cn">T</span>, includedCovariateConceptIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">201820</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h4>
<p>Let’s assumed we have two two cohorts (id 1 and 2) the first cohort
contains five patients who have &gt;365 days prior observation at index
and the second contains three patients who have &gt;365 days prior
observation at index.</p>
<p>The patients features’ are displayed in Table 7, containing patients’
age at index, whether they have diabetes anytime prior to index and
their sex as features.</p>
<table class="table">
<caption>Example patient level feature data.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">cohortId</th>
<th align="left">feature</th>
<th align="left">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">age</td>
<td align="left">50</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">sex</td>
<td align="left">Male</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">diabetes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">age</td>
<td align="left">18</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">sex</td>
<td align="left">Female</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">age</td>
<td align="left">22</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">sex</td>
<td align="left">Male</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">age</td>
<td align="left">40</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">sex</td>
<td align="left">Male</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">age</td>
<td align="left">70</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">sex</td>
<td align="left">Female</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">diabetes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">age</td>
<td align="left">24</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">sex</td>
<td align="left">Female</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2</td>
<td align="left">age</td>
<td align="left">35</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
<td align="left">sex</td>
<td align="left">Female</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">age</td>
<td align="left">31</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">sex</td>
<td align="left">Female</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h4>
<p>We calculate the mean values for each feature per cohort:</p>
<table class="table">
<caption>Example aggregate features for two example cohorts.</caption>
<thead><tr class="header">
<th align="right">cohortId</th>
<th align="left">feature</th>
<th align="right">mean</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Age</td>
<td align="right">40.0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Sex: Male</td>
<td align="right">0.6</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Diabetes: Yes</td>
<td align="right">0.4</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Age</td>
<td align="right">30.0</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Sex: Male</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Diabetes: Yes</td>
<td align="right">0.0</td>
</tr>
</tbody>
</table>
<p>The database and cohort comparison implements the aggregate covariate
analysis for all target and outcome ids fed into characterization across
all OMOP CDM databases available and then lets users compare the mean
values of the features between databases for the same cohort or across
different cohorts within the same database. The standardized mean
different is calculated between two cohorts when possible, this is
calculated per feature as: abs(mean value in cohort 1 - mean value in
cohort 2)/((standard deviation of values in cohort 1 squared plus
standard deviation of values in cohort 2 squared)/2).</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="risk-factor-analysis">Risk Factor Analysis<a class="anchor" aria-label="anchor" href="#risk-factor-analysis"></a>
</h2>
<div class="section level3">
<h3 id="inputs-3">Inputs<a class="anchor" aria-label="anchor" href="#inputs-3"></a>
</h3>
<p>A vector of targetIds and outcomeIds plus the minimum prior
observation required for the target cohorts, the outcome washout days
for the outcomes, settings for the time-at-risk and covariate settings
specifying which features to extract.</p>
</div>
<div class="section level3">
<h3 id="outputs-1">Outputs<a class="anchor" aria-label="anchor" href="#outputs-1"></a>
</h3>
<p>For each target and outcome combination we run aggregate covariate
analysis for the special case of comparing patients in cohort 1
(patients in the target cohort for the first time with 365 days prior
observation who go on to have the first occurrence of the outcome in
washout days during some time-at-risk relative to the target cohort
index) vs cohort 2 (patients in the target cohort for the first time
with 365 days prior observation who do not go on to have the first
occurrence of the outcome in washout days during some time-at-risk
relative to the target cohort index).</p>
</div>
<div class="section level3">
<h3 id="worked-example-3">Worked Example<a class="anchor" aria-label="anchor" href="#worked-example-3"></a>
</h3>
<p>Lets consider an example with a time-at-risk of target cohort start +
1 to target cohort start + 180.</p>
<div class="section level4">
<h4 id="example-inputs-3">Example Inputs<a class="anchor" aria-label="anchor" href="#example-inputs-3"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targetId</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">outcomeId</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">minPriorObservation</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">outcomeWashoutDays</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">riskWindowStart</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">startAnchor</span> <span class="op">&lt;-</span> <span class="st">'cohort start'</span></span>
<span><span class="va">riskWindowEnd</span> <span class="op">&lt;-</span> <span class="fl">180</span></span>
<span><span class="va">endAnchor</span> <span class="op">&lt;-</span> <span class="st">'cohort start'</span></span>
<span><span class="va">covariateSettings</span> <span class="op">&lt;-</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createCovariateSettings.html" class="external-link">createCovariateSettings</a></span><span class="op">(</span></span>
<span>  useDemographicsAge <span class="op">=</span> <span class="cn">T</span>, </span>
<span>  useDemographicsGender <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  useConditionOccurrenceAnyTimePrior <span class="op">=</span> <span class="cn">T</span>, includedCovariateConceptIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">201820</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-data-1">Example Data<a class="anchor" aria-label="anchor" href="#example-data-1"></a>
</h4>
<table class="table">
<caption>Example target cohort.</caption>
<colgroup>
<col width="13%">
<col width="20%">
<col width="22%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
<th align="left">observationStart</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-01-20</td>
<td align="left">2001-01-25</td>
<td align="left">2000-02-01</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-10-20</td>
<td align="left">2001-12-05</td>
<td align="left">2000-02-01</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2005-09-10</td>
<td align="left">2005-09-15</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-02-01</td>
<td align="left">2003-02-30</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-08-04</td>
<td align="left">2003-08-24</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2005-02-01</td>
<td align="left">2005-10-08</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2007-04-03</td>
<td align="left">2007-05-03</td>
<td align="left">2001-02-01</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Example outcome cohort.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">1999-10-03</td>
<td align="left">1999-10-08</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2001-10-30</td>
<td align="left">2001-11-07</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">2004-05-16</td>
<td align="left">2004-05-18</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2002-06-03</td>
<td align="left">2002-06-14</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2003-02-20</td>
<td align="left">2003-03-01</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2006-07-21</td>
<td align="left">2006-08-03</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2008-01-01</td>
<td align="left">2008-01-09</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="intermedeiary-tables">Intermedeiary Tables<a class="anchor" aria-label="anchor" href="#intermedeiary-tables"></a>
</h4>
<p>First, we find the first target with 365 days prior obs. Patient 1 is
removed as they are exposed for the first time with less than 365 days
prior observation. Patients 4 and 5 non-first exposures are removed.
This leaves:</p>
<table class="table">
<caption>Example target cohort meeting risk factor inclusion
criteria.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2005-09-10</td>
<td align="left">2005-09-15</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2005-02-01</td>
<td align="left">2005-10-08</td>
</tr>
</tbody>
</table>
<p>We then find the patients in the target cohort with the outcome and
no-outcome occurring during 1 day to 180 days after index:</p>
<table style="width:100%;" class="table">
<caption>Example target cohort meeting risk factor inclusion
criteria.</caption>
<colgroup>
<col width="14%">
<col width="22%">
<col width="23%">
<col width="20%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
<th align="left">labels</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2005-09-10</td>
<td align="left">2005-09-15</td>
<td align="left">Non-outcome</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
<td align="left">Outcome</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
<td align="left">Outcome</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2005-02-01</td>
<td align="left">2005-10-08</td>
<td align="left">Non-outcome</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> we also remove patients in the target who have
the outcome during outcome washout days prior to target index. In the
example, nobody had the outcome prior, so this was not observed.</p>
<p>If the features for these four patients are:</p>
<table class="table">
<caption>Example patient level feature data.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="left">cohortId</th>
<th align="left">feature</th>
<th align="left">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="left">Non-outcome</td>
<td align="left">age</td>
<td align="left">50</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Non-outcome</td>
<td align="left">sex</td>
<td align="left">Male</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Non-outcome</td>
<td align="left">diabetes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Outcome</td>
<td align="left">age</td>
<td align="left">18</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Outcome</td>
<td align="left">sex</td>
<td align="left">Female</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Outcome</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Outcome</td>
<td align="left">age</td>
<td align="left">22</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Outcome</td>
<td align="left">sex</td>
<td align="left">Male</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Outcome</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">Non-outcome</td>
<td align="left">age</td>
<td align="left">40</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Non-outcome</td>
<td align="left">sex</td>
<td align="left">Male</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">Non-outcome</td>
<td align="left">diabetes</td>
<td align="left">No</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="results-1">Results<a class="anchor" aria-label="anchor" href="#results-1"></a>
</h4>
<p>We calculate the mean values for each feature per non-outcome and
outcome cohort:</p>
<table class="table">
<caption>Example aggregate features for risk factor analysis.</caption>
<thead><tr class="header">
<th align="left">cohortId</th>
<th align="left">feature</th>
<th align="right">mean</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Outcome</td>
<td align="left">Age</td>
<td align="right">20.0</td>
</tr>
<tr class="even">
<td align="left">Outcome</td>
<td align="left">Sex: Male</td>
<td align="right">0.5</td>
</tr>
<tr class="odd">
<td align="left">Outcome</td>
<td align="left">Diabetes: Yes</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">Non-outcome</td>
<td align="left">Age</td>
<td align="right">45.0</td>
</tr>
<tr class="odd">
<td align="left">Non-outcome</td>
<td align="left">Sex: Male</td>
<td align="right">1.0</td>
</tr>
<tr class="even">
<td align="left">Non-outcome</td>
<td align="left">Diabetes: Yes</td>
<td align="right">0.5</td>
</tr>
</tbody>
</table>
<p>We can then implement the standardized mean different calculated
between the outcome and non-outcome cohorts, this is calculated per
feature as: abs(mean value in outcome cohort - mean value in non-outcome
cohort)/((standard deviation of values in outcome cohort squared plus
standard deviation of values in non-outcome cohort squared)/2).</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="case-series">Case Series<a class="anchor" aria-label="anchor" href="#case-series"></a>
</h2>
<p>The cases series looks at the patients in a target cohort who have
the outcome during a specified time-at-risk and calculates the aggregate
covariates at three different time periods: shortly before index,
between target index and outcome index and shortly after outcome
index.</p>
<div class="section level3">
<h3 id="inputs-4">Inputs<a class="anchor" aria-label="anchor" href="#inputs-4"></a>
</h3>
<p>A vector of targetIds and outcomeIds plus the minimum prior
observation required for the target cohorts, the outcome washout days
for the outcomes, settings for the time-at-risk and covariate settings
specifying which features to extract.</p>
<p>In addition you need to specify how long before target index to
extract before index features (preTargetIndexDays) and how long after
outcome index to extract after index features
(postOutcomeIndexDays).</p>
</div>
<div class="section level3">
<h3 id="outputs-2">Outputs<a class="anchor" aria-label="anchor" href="#outputs-2"></a>
</h3>
<p>For each target and outcome combination we run aggregate covariate
analysis patients in the target patients (with a minimum of prior
observation day before index) who have the outcome (for the first time
in outcome washout days). We use three different time periods for
feature extraction:</p>
<ul>
<li>(before) preTargetIndexDays before target index up to target
index</li>
<li>(during) between target index plus 1 day to outcome index</li>
<li>(after) 1 day after outcome index to outcome index plus
postOutcomeIndexDays</li>
</ul>
</div>
<div class="section level3">
<h3 id="worked-example-4">Worked Example<a class="anchor" aria-label="anchor" href="#worked-example-4"></a>
</h3>
<p>In this example we look at how often diabetes is recorded for the
cases (people with the target cohort who have the outcome within 180
days of target index) in the year before target index, between target
index and outcome index and the 1 year after outcome index.</p>
<div class="section level4">
<h4 id="example-inputs-4">Example Inputs<a class="anchor" aria-label="anchor" href="#example-inputs-4"></a>
</h4>
<p>Here we consider the inputs are:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targetId</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">outcomeId</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">minPriorObservation</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">outcomeWashoutDays</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">preTargetIndexDays</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">postOutcomeIndexDays</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">riskWindowStart</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">startAnchor</span> <span class="op">&lt;-</span> <span class="st">'cohort start'</span></span>
<span><span class="va">riskWindowEnd</span> <span class="op">&lt;-</span> <span class="fl">180</span></span>
<span><span class="va">endAnchor</span> <span class="op">&lt;-</span> <span class="st">'cohort start'</span></span>
<span><span class="va">covariateSettings</span> <span class="op">&lt;-</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createCovariateSettings.html" class="external-link">createCovariateSettings</a></span><span class="op">(</span></span>
<span>  useConditionOccurrenceAnyTimePrior <span class="op">=</span> <span class="cn">T</span>, includedCovariateConceptIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">201820</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-data-2">Example Data<a class="anchor" aria-label="anchor" href="#example-data-2"></a>
</h4>
<table class="table">
<caption>Example target cohort.</caption>
<colgroup>
<col width="13%">
<col width="20%">
<col width="22%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
<th align="left">observationStart</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-01-20</td>
<td align="left">2001-01-25</td>
<td align="left">2000-02-01</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-10-20</td>
<td align="left">2001-12-05</td>
<td align="left">2000-02-01</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2005-09-10</td>
<td align="left">2005-09-15</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-02-01</td>
<td align="left">2003-02-30</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2003-08-04</td>
<td align="left">2003-08-24</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2005-02-01</td>
<td align="left">2005-10-08</td>
<td align="left">2001-02-01</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2007-04-03</td>
<td align="left">2007-05-03</td>
<td align="left">2001-02-01</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Example outcome cohort.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">1999-10-03</td>
<td align="left">1999-10-08</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2001-10-30</td>
<td align="left">2001-11-07</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">2004-05-16</td>
<td align="left">2004-05-18</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2002-06-03</td>
<td align="left">2002-06-14</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">2003-02-20</td>
<td align="left">2003-03-01</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2006-07-21</td>
<td align="left">2006-08-03</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2</td>
<td align="left">2008-01-01</td>
<td align="left">2008-01-09</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="intermedeiary-tables-1">Intermedeiary Tables<a class="anchor" aria-label="anchor" href="#intermedeiary-tables-1"></a>
</h4>
<p>First, we find the first target with 365 days prior obs. Patient 1 is
removed as they are exposed for the first time with less than 365 days
prior observation. Patients 4 and 5 non-first exposures are removed.
This leaves:</p>
<table class="table">
<caption>Example target cohort meeting risk factor inclusion
criteria.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">2005-09-10</td>
<td align="left">2005-09-15</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">2005-02-01</td>
<td align="left">2005-10-08</td>
</tr>
</tbody>
</table>
<p>We then find the patients in the target cohort with the outcome
occurring during 1 day to 180 days after index:</p>
<table class="table">
<caption>Example target cohort meeting case inclusion
criteria.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">cohortStartDate</th>
<th align="left">cohortEndDate</th>
<th align="left">labels</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-17</td>
<td align="left">Outcome</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-12</td>
<td align="left">Outcome</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> we also remove patients in the target who have
the outcome during outcome washout days prior to target index. In the
example, nobody had the outcome prior, so this was not observed.</p>
<p>Now we define the before( 365 days before target index up to target
index), between (target index plus 1 and outcome) and after (outcome
index plus 1 to outcome index plus 365):</p>
<table style="width:100%;" class="table">
<caption>Example cases with before/during/after dates.</caption>
<colgroup>
<col width="6%">
<col width="10%">
<col width="10%">
<col width="11%">
<col width="10%">
<col width="9%">
<col width="10%">
<col width="9%">
<col width="10%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="right">targetCohortId</th>
<th align="left">targetStartDate</th>
<th align="left">outcomeStartDate</th>
<th align="left">beforeStartDate</th>
<th align="left">beforeEndDate</th>
<th align="left">duringStartDate</th>
<th align="left">duringEndDate</th>
<th align="left">afterStartDate</th>
<th align="left">afterEndDate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2004-04-02</td>
<td align="left">2004-05-16</td>
<td align="left">2003-04-03</td>
<td align="left">2004-04-02</td>
<td align="left">2004-04-03</td>
<td align="left">2004-05-16</td>
<td align="left">2004-05-17</td>
<td align="left">2005-05-16</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">2002-03-03</td>
<td align="left">2002-06-03</td>
<td align="left">2001-03-03</td>
<td align="left">2002-03-03</td>
<td align="left">2002-03-04</td>
<td align="left">2002-06-03</td>
<td align="left">2002-06-04</td>
<td align="left">2003-06-03</td>
</tr>
</tbody>
</table>
<p>If the features for these two patients at the three time periods
are:</p>
<table class="table">
<caption>Example patient level case feature data.</caption>
<thead><tr class="header">
<th align="right">patientId</th>
<th align="left">feature</th>
<th align="left">timePeriod</th>
<th align="left">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="left">diabetes</td>
<td align="left">before</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">diabetes</td>
<td align="left">during</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">diabetes</td>
<td align="left">after</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">diabetes</td>
<td align="left">before</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">diabetes</td>
<td align="left">during</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">diabetes</td>
<td align="left">after</td>
<td align="left">Yes</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="results-2">Results<a class="anchor" aria-label="anchor" href="#results-2"></a>
</h4>
<p>Finally, we aggregate over the time periods:</p>
<table class="table">
<caption>Example patient level case feature data.</caption>
<thead><tr class="header">
<th align="left">feature</th>
<th align="left">timePeriod</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">diabetes: Yes</td>
<td align="left">before</td>
<td align="right">0.5</td>
</tr>
<tr class="even">
<td align="left">diabetes: Yes</td>
<td align="left">during</td>
<td align="right">0.5</td>
</tr>
<tr class="odd">
<td align="left">diabetes: Yes</td>
<td align="left">after</td>
<td align="right">1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jenna Reps, Patrick Ryan, Chris Knoll.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
